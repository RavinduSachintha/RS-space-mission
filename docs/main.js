!function(){"use strict";!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}("body{text-align:center;background-color:#404040}#canvas1{margin-top:20px;border:1px solid grey}");let t,e,i={};function s(t,...e){(i[t]||[]).map(t=>t(...e))}function n(){return e}let r=/(jpeg|jpg|gif|png)$/,a=/(wav|mp3|ogg|aac)$/,h=/^\//,o=/\/$/,l=new WeakMap;function c(t,e){return new URL(t,e).href}function d(t,e){return[t.replace(o,""),t?e.replace(h,""):e].filter(t=>t).join("/")}function u(t){return t.split(".").pop()}function y(t){let e=t.replace("."+u(t),"");return 2==e.split("/").length?e.replace(h,""):e}let p={},f={},g={};function m(){window.__k||(window.__k={dm:l,u:c,d:g,i:p})}function x(...t){return m(),Promise.all(t.map(t=>{let e=u([].concat(t)[0]);return e.match(r)?(i=t,m(),new Promise((t,e)=>{let n,r,a;if(n=d("",i),p[n])return t(p[n]);r=new Image,r.onload=function(){a=c(n,window.location.href),p[y(i)]=p[n]=p[a]=this,s("assetLoaded",this,i),t(this)},r.onerror=function(){e("Unable to load image "+n)},r.src=n})):e.match(a)?function(t){return new Promise((e,i)=>{let n,r,a,h,o=t;var l;return n=new Audio,r={wav:(l=n).canPlayType('audio/wav; codecs="1"'),mp3:l.canPlayType("audio/mpeg;"),ogg:l.canPlayType('audio/ogg; codecs="vorbis"'),aac:l.canPlayType("audio/aac;")},(t=[].concat(t).reduce((t,e)=>t||(r[u(e)]?e:null),0))?(a=d("",t),f[a]?e(f[a]):(n.addEventListener("canplay",(function(){h=c(a,window.location.href),f[y(t)]=f[a]=f[h]=this,s("assetLoaded",this,t),e(this)})),n.onerror=function(){i("Unable to load audio "+a)},n.src=a,void n.load())):i("cannot play any of the audio formats provided "+o)})}(t):function(t){let e,i;return m(),e=d("",t),g[e]?Promise.resolve(g[e]):fetch(e).then(t=>{if(!t.ok)throw t;return t.clone().json().catch(()=>t.text())}).then(n=>(i=c(e,window.location.href),"object"==typeof n&&l.set(n,i),g[y(t)]=g[e]=g[i]=n,s("assetLoaded",n,t),n))}(t);var i}))}function w(t){return t*Math.PI/180}function _(t,e,i){return Math.min(Math.max(t,i),e)}class v{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new v(this.x+t.x,this.y+t.y,this)}subtract(t){return new v(this.x-t.x,this.y-t.y,this)}scale(t){return new v(this.x*t,this.y*t)}normalize(t=this.length()){return new v(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?_(this._a,this._d,t):t}set y(t){this._y=this._c?_(this._b,this._e,t):t}}function T(){return new v(...arguments)}T.prototype=v.prototype,T.class=v;const b=()=>{};class P extends class{constructor(t){return this.init(t)}init(t={}){this.position=T(),this.velocity=T(),this.acceleration=T(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=n(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:h={x:0,y:0},sx:o=0,sy:l=0,opacity:c=1,rotation:d=0,scaleX:u=1,scaleY:y=1,...p}={}){this.children=[],super.init({width:t,height:e,context:i,anchor:h,sx:o,sy:l,opacity:c,rotation:d,scaleX:u,scaleY:y,...p}),this._di=!0,this._uw(),a.map(t=>this.addChild(t)),this._rf=s,this._uf=r}update(t){this._uf(t),this.children.map(t=>t.update&&t.update())}render(t){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.sx||this.sy)&&e.translate(-this.sx,-this.sy),1==this.scaleX&&1==this.scaleY||e.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&e.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&e.translate(-i,-s);let n=this.children;t&&(n=n.filter(t)),n.map(t=>t.render&&t.render()),e.restore()}draw(){}_pc(t,e){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:n=1,_wsy:r=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wr=s+this.rotation;let{x:a,y:h}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this.x,y:this.y},s);this._wx=a,this._wy=h,this._wsx=n*this.scaleX,this._wsy=r*this.scaleY,this._wx=this.x*n,this._wy=this.y*r,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}addChild(t,{absolute:e=!1}={}){this.children.push(t),t.parent=this,t._pc=t._pc||b,t._pc()}removeChild(t){let e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.parent=null,t._pc())}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function M(){return new P(...arguments)}M.prototype=P.prototype,M.class=P;class S extends M.class{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function F(){return new S(...arguments)}function C(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}F.prototype=S.prototype,F.class=S;let A={},k={},E={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"left",ArrowUp:"up",ArrowRight:"right",ArrowDown:"down"};function I(t){let e=E[t.code];k[e]=!0,A[e]&&A[e](t)}function L(t){k[E[t.code]]=!1}function D(){k={}}function Y(t){return!!k[t]}var X,R,j=function(i){if(t=document.getElementById(i)||i||document.querySelector("canvas"),!t)throw Error("You must provide a canvas element for the game");return e=t.getContext("2d"),e.imageSmoothingEnabled=!1,s("init"),{canvas:t,context:e}}("canvas1"),z=j.canvas,q=j.context,B=z.width-5,O=z.height-5,U=B-5,W=O-5,$={player:null,enemies:[],stars:[],bullets:[],smokes:[]},G={numOfItems:1,assetsLoaded:0};function N(t,e,i,s,n,r){return F({x:t,y:e,dx:i,dy:s,width:4,height:4,radius:4,color:n,energy:1,ttl:100,type:"bullet",by:r})}function K(){return F({x:50,y:(O-5)/2,type:"player",anchor:{x:.5,y:.5},radius:24,dt:0,action:"default",isEnable:!1,isDestroyed:!1,maxSpeed:3.5,energy:100,render:function(){var t,e;t=this.action,e=this.radius,t=t||"default",e=e||0,q.translate(-e,0),q.beginPath(),q.moveTo(25,-5),q.lineTo(20,-12),q.lineTo(9,-11),q.lineTo(8,-9),q.lineTo(18,-4),q.lineTo(18,4),q.lineTo(8,9),q.lineTo(9,11),q.lineTo(20,12),q.lineTo(25,5),q.closePath(),q.fillStyle="#CCCCCC",q.fill(),q.beginPath(),q.moveTo(3,0),q.quadraticCurveTo(36,-15,48,0),q.moveTo(3,0),q.quadraticCurveTo(36,15,48,0),q.closePath(),q.fillStyle="#48A0DC",q.fill(),q.beginPath(),q.arc(36,0,5,0,2*Math.PI),q.closePath(),q.fillStyle="#4D4D4D",q.fill(),q.beginPath(),q.arc(36,0,3,0,2*Math.PI),q.closePath(),q.fillStyle="#FFF",q.fill(),q.beginPath(),q.moveTo(12,-4),q.lineTo(12,4),q.lineTo(9,3),q.lineTo(9,-3),q.closePath(),q.fillStyle="#387AA7",q.fill(),q.beginPath(),q.moveTo(9,-3),"default"===t?q.bezierCurveTo(-8,-2,-8,2,9,3):"turn-left"===t?q.bezierCurveTo(-8,-5,-8,-1,9,3):"turn-right"===t&&q.bezierCurveTo(-8,1,-8,5,9,3),q.closePath(),q.fillStyle="#FFCC66",q.fill(),q.beginPath(),q.moveTo(9,-1.5),"default"===t?q.bezierCurveTo(-4,-1,-4,1,9,1.5):"turn-left"===t?q.bezierCurveTo(-4,-3.5,-4,-1.5,9,1.5):"turn-right"===t&&q.bezierCurveTo(-4,1.5,-4,3.5,9,1.5),q.closePath(),q.fillStyle="#ED7161",q.fill(),"destroyed"===t&&(q.translate(24,0),q.beginPath(),q.moveTo(0,-30),q.lineTo(10,-11),q.lineTo(30,-7),q.lineTo(16,9),q.lineTo(19,30),q.lineTo(0,21),q.lineTo(-19,30),q.lineTo(-16,9),q.lineTo(-30,-7),q.lineTo(-10,-11),q.closePath(),q.fillStyle="#FFA500",q.fill(),q.beginPath(),q.moveTo(0,-15),q.lineTo(5,-5.5),q.lineTo(15,-3.5),q.lineTo(8,4.5),q.lineTo(9.5,15),q.lineTo(0,10.5),q.lineTo(-9.5,15),q.lineTo(-8,4.5),q.lineTo(-15,-3.5),q.lineTo(-5,-5.5),q.closePath(),q.fillStyle="#F00",q.fill())},update:function(){this.action="default",Y("left")&&(this.action="turn-left",this.rotation+=w(-3)*(this.velocity.length()/this.maxSpeed)),Y("right")&&(this.action="turn-right",this.rotation+=w(3)*(this.velocity.length()/this.maxSpeed)),(this.x<5||this.x>B||this.y<25||this.y>O)&&(this.isEnable=!1,this.isDestroyed=!0);var t=Math.cos(this.rotation),e=Math.sin(this.rotation);if(Y("s")&&(this.isEnable=!0,this.isDestroyed=!1),Y("d")&&(this.isEnable=!1),this.isEnable?(this.ddx=.05*t,this.ddy=.05*e):(this.ddx=0,this.ddy=0,this.dx=0,this.dy=0),this.advance(),this.velocity.length()>this.maxSpeed&&(this.dx*=.95,this.dy*=.95),this.dt+=1/60,Y("space")&&this.dt>.25){this.dt=0;var i=N(this.x+25*t,this.y+25*e,this.dx+5*t,this.dy+5*e,"#FF0","player");$.bullets.push(i)}this.isDestroyed&&(this.action="destroyed")}})}R=function(t,e){G.assetsLoaded++},i[X="assetLoaded"]=i[X]||[],i[X].push(R);var H=[[Math.round(.35*U),Math.round(Math.random()*(W-75)+60)],[Math.round(.6*U),Math.round(Math.random()*(W-75)+60)],[Math.round(.9*U),Math.round(Math.random()*(W-75)+60)]];function J(t,e,i,s,n){for(var r=[],a=0;a<t;a++)r.push(F({x:e+40*(Math.random()-.5),y:i+50*Math.random(),dx:s*(Math.random()-.5)*2,dy:n,type:"smoke",width:2,height:5,color:"#FFF",ttl:10}));return r}document.write('<script src="http://'+(location.host||"localhost").split(":")[0]+':35729/livereload.js?snipver=1" async><\/script>'),x("assets/enemy.png").then((function(){G.assetsLoaded==G.numOfItems&&(function(){let t;for(t=0;t<26;t++)E[t+65]=E["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)E[48+t]=E["Digit"+t]=""+t;window.addEventListener("keydown",I),window.addEventListener("keyup",L),window.addEventListener("blur",D)}(),function(t){for(var e=[],i=0;i<t;i++){var s=F({x:Math.random()*(B-5-75)+50,y:Math.random()*(O-5-75)+50,type:"star",opacity:.4*Math.random(),scaleX:.2,scaleY:.2,render:function(){q.translate(0,0),q.beginPath(),q.moveTo(0,-15),q.lineTo(5,-5.5),q.lineTo(15,-3.5),q.lineTo(8,4.5),q.lineTo(9.5,15),q.lineTo(0,10.5),q.lineTo(-9.5,15),q.lineTo(-8,4.5),q.lineTo(-15,-3.5),q.lineTo(-5,-5.5),q.closePath(),q.fillStyle="#FFF",q.fill()}});e.push(s)}return e}(100).forEach((function(t){return $.stars.push(t)})),function(){for(var t=[],e=0;e<3;e++){var i=H[e],s=F({x:i[0],y:i[1],anchor:{x:.5,y:.5},type:"enemy",energy:20,shaking:0,rotation:w(30*(Math.random()-.5)),action:"default",radius:32,range:120,isFiring:!1,dt:0,render:function(){var t,e;this.action,t=(t=this.radius)||0,e=(e=this.energy)||20,q.translate(-t,0),q.beginPath(),q.ellipse(t,-8,12,12,0,0,2*Math.PI),q.closePath(),q.fillStyle="#FF0",q.fill(),q.lineWidth=2,q.beginPath(),q.ellipse(t,-8,12,12,0,0,2*Math.PI),q.closePath(),q.strokeStyle="#080",q.stroke(),q.beginPath(),q.ellipse(t,0,32,12,0,0,2*Math.PI),q.closePath(),q.fillStyle="#0A0",q.fill(),q.beginPath(),q.ellipse(t,0,32,12,0,0,2*Math.PI),q.closePath(),q.strokeStyle="#080",q.stroke(),q.beginPath(),q.arc(t,0,2,0,2*Math.PI),q.arc(t-9,0,2,0,2*Math.PI),q.arc(t+9,0,2,0,2*Math.PI),q.arc(t-18,0,2,0,2*Math.PI),q.arc(t+18,0,2,0,2*Math.PI),q.arc(t-27,0,2,0,2*Math.PI),q.arc(t+27,0,2,0,2*Math.PI),q.closePath(),q.fillStyle="#FFF",q.fill(),q.beginPath(),q.rect(t-10,-30,20*e/20,5),q.closePath(),q.fillStyle="#F00",q.fill(),q.lineWidth=1,q.beginPath(),q.rect(t-10,-30,20,5),q.closePath(),q.strokeStyle="#FF8080",q.stroke()},update:function(){if(0==this.shaking?(this.rotation+=w(-1.5),this.shaking=this.rotation>w(-20)?0:1):1==this.shaking&&(this.rotation+=w(1.5),this.shaking=this.rotation<w(20)?1:0),this.dt+=1/60,this.isFiring&&this.dt>.1){var t=Math.hypot($.player.x-this.x,$.player.y-this.y),e=($.player.x-this.x)/t,i=($.player.y-this.y)/t,s=N(this.x,this.y,4*e,4*i,"#AFA","enemy");$.bullets.push(s)}this.dt>.1&&(this.dt=0,J(15,this.x,this.y+15,1,2).forEach((function(t){return $.smokes.push(t)})))}});t.push(s)}return t}().forEach((function(t){return $.enemies.push(t)})),$.player=K(),function({fps:t=60,clearCanvas:e=!0,update:i=b,render:r,context:a=n()}={}){if(!r)throw Error("You must provide a render() function");let h,o,l,c,d,u=0,y=1e3/t,p=1/t,f=e?C:b;function g(){if(o=requestAnimationFrame(g),l=performance.now(),c=l-h,h=l,!(c>1e3)){for(s("tick"),u+=c;u>=y;)d.update(p),u-=y;f(a),d.render()}}return d={update:i,render:r,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(g)},stop(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:g,set _last(t){h=t}},d}({update:function(){$.player.update(),$.enemies.map((function(t){t.update(),$.bullets.forEach((function(e){"player"===e.by&&Math.hypot(t.x-e.x,t.y-e.y)<t.radius+e.radius&&(t.energy-=e.energy,e.ttl=0),"enemy"===e.by&&Math.hypot($.player.x-e.x,$.player.y-e.y)<$.player.radius+e.radius&&($.player.energy-=e.energy,e.ttl=0)}));var e=Math.hypot(t.x-$.player.x,t.y-$.player.y);e<t.range?(t.isFiring=!0,e<t.radius+$.player.radius-10&&($.player.isEnable=!1,$.player.isDestroyed=!0,t.isFiring=!1)):t.isFiring=!1,t.energy<=0&&(t.ttl=0),$.player.energy<=0&&($.player.isEnable=!1,$.player.isDestroyed=!0)})),$.smokes.map((function(t){return t.update()})),$.bullets.map((function(t){return t.update()})),$.enemies=$.enemies.filter((function(t){return t.isAlive()})),$.bullets=$.bullets.filter((function(t){return t.isAlive()})),$.smokes=$.smokes.filter((function(t){return t.isAlive()}))},render:function(){var t;(t=q.createLinearGradient((B-5)/2,15,(B-5)/2,O)).addColorStop(0,"#070B34"),t.addColorStop(1,"#854088"),q.fillStyle=t,q.fillRect(5,25,B-5,O-5-20),$.stars.map((function(t){return t.render()})),$.enemies.map((function(t){return t.render()})),$.smokes.map((function(t){return t.render()})),$.player.render(),$.bullets.map((function(t){return t.render()})),function(){q.fillStyle="#FFF",q.fillRect(5,5,B-5,20);var t=q.createRadialGradient((B-5)/2,(O-5)/2,100,(B-5)/2,(O-5)/2,(B-5)/2+300);t.addColorStop(0,"#FFF"),t.addColorStop(1,"#000"),q.strokeStyle=t,q.lineWidth=5,q.strokeRect(2.5,2.5,B,O)}()}}).start())})).catch((function(t){console.log(t)}))}();
